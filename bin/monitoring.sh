#!/bin/sh
Author="Andre Augusto Ribas"
SoftwareVersion="1.0.3"
DateCreation="21/11/2024"
DateModification="22/11/2024"
EMAIL_1="dba.ribas@gmail.com"
EMAIL_2="andre.ribas@icloud.com"
WEBSITE="http://dbnitro.net"
#
V_CONN="sqlplus -S / as sysdba"
#
printf '%*s\n' "${COLUMNS:-$(tput cols)}" '' | tr ' ' - 
#
printf "+%-50s+\n"       "--------------------------------------------------"
printf "|%-50s%-s|\n"    " ORACLE SYSTEM                                    "
printf "+%-50s+%-70s+\n" "--------------------------------------------------" "----------------------------------------------------------------------"
printf "|%-50s|%-70s|\n" " SERVICE                                          " " VALUE                                                                "
printf "+%-50s+%-70s+\n" "--------------------------------------------------" "----------------------------------------------------------------------"
printf "|%-50s|%-70s|\n" " Database Name...................................." " $(echo "select name from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Software Release........................" " $(echo "select substr(banner,1,67) from v\$version where banner like 'Oracle Database%';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Version................................." " $(echo "select 'Version: ' || version || ' | Full Version: ' || version_full from v\$instance;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Platform................................" " $(echo "select PLATFORM_NAME from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Status.................................." " $(echo "select status from v\$instance;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Open Mode..............................." " $(echo "select open_mode from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Role...................................." " $(echo "select database_role from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Characterset............................" " $(echo "select to_char(value) from nls_database_parameters where parameter = 'NLS_CHARACTERSET';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Type...................................." " $(echo "select database_type from v\$instance;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Size...................................." " $(echo "select trim(to_char(SUM(bytes/1024/1024), '999,999,990.00')) || ' MB | ' || trim(to_char(SUM(bytes/1024/1024/1024), '999,999,990.00')) || ' GB | ' || trim(to_char(SUM(bytes/1024/1024/1024/1024), '999,999,990.00')) || ' TB' FROM dba_data_files;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database CPU....................................." " $(echo "select to_char(value) || ' => ' || comments from v\$osstat where stat_name in ('NUM_CPUS','NUM_CPU_CORES','NUM_CPU_SOCKETS');" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Memory.................................." " $(echo "select round(value/1024/1024/1024, 2) || ' GB => Physical Memory' from v\$osstat where stat_name in ('PHYSICAL_MEMORY_BYTES');" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database SGA....................................." " $(echo "select trim(to_char(sum(value/1024/1024), '999G999G999G999D999')) || ' MB' || ' | ' || trim(to_char(sum(value/1024/1024/1024), '999G999G999G999D999')) || ' GB' from v\$sga;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database PGA....................................." " $(echo "select trim(to_char(SUM(value/1024/1024), '999G999G999G999D999')) || ' MB' || ' | ' || trim(to_char(SUM(value/1024/1024/1024), '999G999G999G999D999')) || ' GB' from v\$pgastat WHERE name = 'total PGA allocated';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Process Limit..........................." " $(echo "select 'Process Limit: ' || trim(initial_allocation) || ' | Max Utilization: ' || max_utilization from v\$resource_limit where resource_name = 'processes';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Sessions Limit.........................." " $(echo "select 'Sessions Limit: ' || trim(initial_allocation) || ' | Max Utilization: ' || max_utilization from v\$resource_limit where resource_name = 'sessions';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Availability............................" " $(echo "select 'Started Up: ' ||to_char(startup_time, 'YYYY-MM-DD hh24:mi') from v\$instance;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Tablespaces............................." " $(echo "select LISTAGG(status_count, ' | ') WITHIN GROUP (ORDER BY status) AS status_summary FROM (SELECT COUNT(*) || ' => ' || status AS status_count, status FROM (SELECT CASE WHEN ROUND((total_used/total_space) * 100, 2) > 90 THEN 'Critical' WHEN ROUND((total_used/total_space) * 100, 2) > 80 THEN 'Warning' ELSE 'OK' END AS status FROM (SELECT df.tablespace_name, SUM(df.bytes - NVL(fs.bytes, 0)) AS total_used, SUM(df.bytes) AS total_space FROM dba_data_files df LEFT JOIN dba_free_space fs ON df.tablespace_name = fs.tablespace_name GROUP BY df.tablespace_name)) GROUP BY status);" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Datafiles..............................." " $(echo "select dbms_xplan.FORMAT_NUMBER(count(*)) || 'Datafiles' from dba_data_files;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Online Redologs........................." " $(echo "select count(*) || ' Groups | ' || count(DISTINCT group#) || ' Files With ' || bytes/1024/1024 || ' MB Each' AS result from v\$log GROUP BY bytes;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Standby Redologs........................" " $(echo "select CASE WHEN count(*) = 0 THEN 'No Standby Groups Found' ELSE count(DISTINCT group#) || ' Groups | ' || count(*) || ' Files with ' || ROUND(SUM(bytes)/1024/1024, 2) || ' MB Each' END AS standby_log_status from v\$standby_log;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Dataguard..............................." " $(echo "select case when value = 'FALSE' then 'NO' when value = 'TRUE' then 'YES' end from v\$parameter where name = 'dg_broker_start';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Jobs...................................." " $(echo "select count(CASE WHEN status = 'SUCCEEDED' THEN 1 END) || ' Jobs Success' || ' | ' || count(CASE WHEN status != 'SUCCEEDED' THEN 1 END) || ' Jobs NOT Success' from dba_scheduler_job_run_details WHERE log_date >= SYSDATE - 1;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Statistics.............................." " $(echo "select 'GATHER_STATS_JOB: ' || status FROM DBA_SCHEDULER_JOB_RUN_DETAILS WHERE job_name = 'GATHER_STATS_JOB' AND actual_start_date >= SYSTIMESTAMP - 1;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Archivelog Mode........................." " $(echo "select case when log_mode ='ARCHIVELOG' then 'YES' else 'NO' end from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Archive Lag Target......................" " $(echo "select value || ' Seconds' from v\$parameter where name = 'archive_lag_target';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Undo Retention.........................." " $(echo "select value || ' Seconds' from v\$parameter where name = 'undo_retention';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Flashback ON............................" " $(echo "select case when log_mode ='FORCE_LOGGING' then 'YES' else 'NO' end from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Flash Recovery Area....................." " $(echo "SELECT 'Total: ' || trim(to_char(space_limit/1024/1024/1024, '999,999.99')) || ' GB => Used: ' || trim(to_char(space_used/1024/1024, '999,999.99')) || ' GB => ' || round((space_used/space_limit) * 100, 2) || '%' FROM v\$recovery_file_dest;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Force Logging..........................." " $(echo "select case when log_mode ='FLASHBACK_ON' then 'YES' else 'NO' end from v\$database;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Alert Log..............................." " $(echo "select count(*) || ' Oracle Errors' from sys.X\$DBGALERTEXT where (lower(MESSAGE_TEXT) like '%ora-%' or lower(MESSAGE_TEXT) like '%error%' or lower(MESSAGE_TEXT) like '%fail%') and ORIGINATING_TIMESTAMP > sysdate - 1;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Backup.................................." " $(echo "select 'Full => ' || (select count(*) from V\$RMAN_BACKUP_JOB_DETAILS WHERE INPUT_TYPE = 'DB FULL' AND START_TIME > SYSDATE - 1) || ' times | ' || 'Inc => ' || (select count(*) from V\$RMAN_BACKUP_JOB_DETAILS WHERE INPUT_TYPE = 'INCREMENTAL' AND START_TIME > SYSDATE - 1) || ' times | ' || 'Arch => ' || (SELECT COUNT(*) from V\$RMAN_BACKUP_JOB_DETAILS WHERE INPUT_TYPE = 'ARCHIVELOG' AND START_TIME > SYSDATE - 1) || ' times' AS backup_summary from dual;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Components Status......................." " $(echo "select count(CASE WHEN status = 'VALID' THEN 1 END) || ' => Valid | ' || count(CASE WHEN status = 'INVALID' THEN 1 END) || ' => Invalid | ' || count(CASE WHEN status not in ('INVALID','VALID') THEN 1 END) || ' => OPTION OFF' from DBA_REGISTRY;" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Objects Status.........................." " $(echo "select 'Invalid Ojbects: ' || trim(count(*)) from all_objects where status != 'VALID';" | ${V_CONN} | tail -2) "
printf "|%-50s|%-70s|\n" " Database Patches................................." " $(echo "select 'Patch ID: ' || patch_id || ' | Applied: ' || to_char(action_time, 'YYYY-MM-DD hh24:mm:ss') from dba_registry_sqlpatch where description like '%Release Update%' order by action_time DESC FETCH FIRST 1 ROW ONLY;" | ${V_CONN} | tail -2) "
printf "+%-50s+%-70s+\n" "--------------------------------------------------" "----------------------------------------------------------------------"